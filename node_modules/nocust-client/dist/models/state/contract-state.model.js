"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var bignumber_js_1=__importDefault(require("bignumber.js")),contract_api_service_1=require("../../services/contract-api.service"),ContractState=function(){function t(e,t,n,i,s,o,a,r,u,l,c,h,d,b,m,p,g,f,_){void 0===g&&(g=[new bignumber_js_1.default(0),new bignumber_js_1.default(0),new bignumber_js_1.default(0)]),void 0===f&&(f=0),this.networkId=e,this.genesis=t,this.block=n,this.currentEonNumber=i,this.currentSubBlock=s,this.blocksPerEon=o,this.slackPeriod=a,this.extendedSlackPeriod=r,this.eonsKept=u,this.depositsKept=l,this.contractBalance=c,this.hasOutstandingChallenges=h,this.slackingChallenges=d,this.challengeCost=b,this.onChainBalance=m,this.pendingWithdrawals=p,this.deposits=g,this.timestamp=f,this.LatestEonsData=_,this.syncPeriod=2e4}return t.fromJSON=function(e){return new t(e.networkId,e.genesis,e.block,e.currentEonNumber,e.currentSubBlock,e.blocksPerEon,e.slackPeriod,e.extendedSlackPeriod,e.eonsKept,e.depositsKept,e.contractBalance?new bignumber_js_1.default(e.contractBalance):void 0,e.hasOutstandingChallenges,e.slackingChallenges,e.challengeCost?new bignumber_js_1.default(e.challengeCost):void 0,e.onChainBalance?new bignumber_js_1.default(e.onChainBalance):void 0,e.pendingWithdrawals?e.pendingWithdrawals.map(function(e){return{amount:e.amount?new bignumber_js_1.default(e.amount):void 0,eonNumber:e.eonNumber}}):void 0,e.deposits?e.deposits.map(function(e){return new bignumber_js_1.default(e)}):void 0,e.timestamp,e.LatestEonsData)},Object.defineProperty(t.prototype,"json",{get:function(){return{networkId:this.networkId,genesis:this.genesis,block:this.block,currentEon:this.currentEonNumber,currentSubBlock:this.currentSubBlock,blocksPerEon:this.blocksPerEon,slackPeriod:this.slackPeriod,extendedSlackPeriod:this.extendedSlackPeriod,eonsKept:this.eonsKept,depositsKept:this.depositsKept,lastSubmissionEon:this.lastSubmissionEon,contractBalance:this.contractBalance?this.contractBalance.toFixed(0):void 0,lastCheckpointSubmitted:this.lastCheckpointSubmitted,hasOutstandingChallenges:this.hasOutstandingChallenges,liveChallenges:this.liveChallenges,slackingChallenges:this.slackingChallenges,challengeCost:this.challengeCost?this.challengeCost.toFixed(0):void 0,onChainBalance:this.onChainBalance?this.onChainBalance.toFixed(0):void 0,pendingWithdrawals:this.pendingWithdrawals?this.pendingWithdrawals.map(function(e){return{eonNumber:e.eonNumber,amount:e.amount?e.amount.toFixed(0):void 0}}):void 0,deposits:this.deposits?this.deposits.map(function(e){return e.toFixed(0)}):void 0,timestamp:this.timestamp,LatestEonsData:this.LatestEonsData}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCheckpointSubmitted",{get:function(){return this.lastSubmissionEon===this.currentEonNumber},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStateSynced",{get:function(){return(new Date).getTime()-this.timestamp<=this.syncPeriod},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPunished",{get:function(){return this.hasMissedCheckpointSubmission||this.hasOutstandingChallenges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastSubmissionEon",{get:function(){return this.LatestEonsData?Math.max.apply(Math,this.LatestEonsData.map(function(e){return e.eonNumber})):0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastCheckpointSubmitted",{get:function(){var t=this;return this.LatestEonsData?this.LatestEonsData.find(function(e){return e.eonNumber===t.lastSubmissionEon}).merkleRoot:"0x0000000000000000000000000000000000000000"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"liveChallenges",{get:function(){var t=this;return this.LatestEonsData?this.LatestEonsData.find(function(e){return e.eonNumber===t.lastSubmissionEon}).liveChallenges:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMissedCheckpointSubmission",{get:function(){return 1<contract_api_service_1.ContractApiService.eonNumberAt(this.block,this.genesis,this.blocksPerEon)-this.lastSubmissionEon},enumerable:!0,configurable:!0}),t.EMPTY_STATE=new t(0,0,0,0,0,0,0,0,0,0,new bignumber_js_1.default(0),!1,0,new bignumber_js_1.default(0),new bignumber_js_1.default(0),[],[new bignumber_js_1.default(0),new bignumber_js_1.default(0),new bignumber_js_1.default(0)],0,[{eonNumber:0,merkleRoot:"0x0000000000000000000000000000000000000000",liveChallenges:0}]),t}();exports.ContractState=ContractState;