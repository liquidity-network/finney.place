"use strict";var __decorate=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,c=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;0<=a;a--)(i=e[a])&&(c=(o<3?i(c):3<o?i(t,r,c):i(t,r))||c);return 3<o&&c&&Object.defineProperty(t,r,c),c},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(r,n){return function(e,t){n(e,t,r)}},__awaiter=this&&this.__awaiter||function(o,c,a,u){return new(a||(a=Promise))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(r,n)}i((u=u.apply(o,c||[])).next())})},__generator=this&&this.__generator||function(r,n){var i,o,c,e,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(c=2&t[0]?o.return:t[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,t[1])).done)return c;switch(o=0,c&&(t=[2&t[0],c.value]),t[0]){case 0:case 1:c=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(c=0<(c=a.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3])){a.label=t[1];break}if(6===t[0]&&a.label<c[1]){a.label=c[1],c=t;break}if(c&&a.label<c[2]){a.label=c[2],a.ops.push(t);break}c[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(r,a)}catch(e){t=[6,e],o=0}finally{i=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(exports,"__esModule",{value:!0});var inversify_1=require("inversify"),__1=require("../.."),util_1=require("../../util"),EthereumRPCService=function(){function e(e){this.web3Provider=e}return Object.defineProperty(e.prototype,"rpc",{get:function(){return this.web3Provider.rpc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isConnected",{get:function(){return void 0!==this.rpc?this.rpc.eth.net.isListening():Promise.resolve(!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accounts",{get:function(){var t=this,n=this;return new Promise(function(r,e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,n.isConnected];case 1:return e.sent()?(t=r,[4,n.rpc.eth.getAccounts()]):[3,3];case 2:return t.apply(void 0,[e.sent().concat(this.privateAccounts)]),[3,4];case 3:r([]),e.label=4;case 4:return[2]}})})})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"privateAccounts",{get:function(){return Array.from(this.rpc.eth.accounts.wallet).map(function(e){return e.address})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentProvider",{get:function(){return this.rpc.currentProvider},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canSignPersonal",{get:function(){return this.rpc.personal&&this.rpc.personal.sign},enumerable:!0,configurable:!0}),e.prototype.getContractAt=function(e,t){return new this.rpc.eth.Contract(e,t)},e.prototype.networkId=function(){var r=this;return this.cachedNetworkId?Promise.resolve(this.cachedNetworkId):new Promise(function(e,t){r.rpc.eth.net.getId(util_1.promiseExecutorCallback(e,t))}).then(function(e){var t=util_1.intValueOfResult(e);return r.cachedNetworkId=t})},e.prototype.latestBlockNumber=function(){var r=this;return new Promise(function(e,t){r.rpc.eth.getBlockNumber(util_1.promiseExecutorCallback(e,t))})},e.prototype.balanceOf=function(r){var n=this;return new Promise(function(e,t){n.rpc.eth.getBalance(util_1.add0xPrefix(r),util_1.promiseExecutorCallback(e,t))}).then(util_1.bigNumberValueOfResult)},e.prototype.signPersonalMessage=function(r,n){var i=this;return new Promise(function(e,t){i.rpc.personal.sign(util_1.lqdWrapper(r),n,util_1.promiseExecutorCallback(e,t))})},e.prototype.signRawDigest=function(n,i){var o=this,c=this;return new Promise(function(e,t){var r=c.privateAccounts.indexOf(i);-1!==r?e(o.rpc.eth.accounts.wallet[r].sign(util_1.lqdWrapper(n)).signature):c.rpc.eth.sign(util_1.lqdWrapper(n),i,util_1.promiseExecutorCallback(e,t))})},e.prototype.recoverPersonalSigningAddress=function(e,r){var n=this;return new Promise(function(e,t){n.rpc.personal.ecRecover(r.checksum,util_1.add0xPrefix(r.rsv),util_1.promiseExecutorCallback(e,t))})},e.prototype.mineTestBlock=function(){var r=this;return new Promise(function(e,t){r.rpc.currentProvider.sendAsync({jsonrpc:"2.0",method:"evm_mine",id:12345,params:[]},util_1.promiseExecutorCallback(e,t))})},e.prototype.getOnChainTransactionReceipt=function(e){return this.rpc.eth.getTransactionReceipt(e)},e=__decorate([inversify_1.injectable(),__param(0,inversify_1.inject(__1.TYPES.EXTERNAL.RPC_PROVIDER_INTERFACE)),__metadata("design:paramtypes",[Object])],e)}();exports.EthereumRPCService=EthereumRPCService;