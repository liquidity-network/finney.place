"use strict";var __decorate=this&&this.__decorate||function(e,t,r,s){var a,n=arguments.length,o=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var i=e.length-1;0<=i;i--)(a=e[i])&&(o=(n<3?a(o):3<n?a(t,r,o):a(t,r))||o);return 3<n&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(r,s){return function(e,t){s(e,t,r)}},__awaiter=this&&this.__awaiter||function(n,o,i,c){return new(i||(i=Promise))(function(e,t){function r(e){try{a(c.next(e))}catch(e){t(e)}}function s(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){t.done?e(t.value):new i(function(e){e(t.value)}).then(r,s)}a((c=c.apply(n,o||[])).next())})},__generator=this&&this.__generator||function(r,s){var a,n,o,e,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,n&&(o=2&t[0]?n.return:t[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,t[1])).done)return o;switch(n=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return i.label++,{value:t[1],done:!1};case 5:i.label++,n=t[1],t=[0];continue;case 7:t=i.ops.pop(),i.trys.pop();continue;default:if(!(o=0<(o=i.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){i=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){i.label=t[1];break}if(6===t[0]&&i.label<o[1]){i.label=o[1],o=t;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(t);break}o[2]&&i.ops.pop(),i.trys.pop();continue}t=s.call(r,i)}catch(e){t=[6,e],n=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var inversify_1=require("inversify"),hdkey_1=__importDefault(require("hdkey")),ethereumjs_util_1=require("ethereumjs-util"),wallet_model_1=require("../models/wallet/wallet.model"),tex_sub_account_model_1=require("../models/wallet/tex-sub-account.model"),contract_api_service_1=require("./contract-api.service"),operator_api_service_1=require("./operator-api.service"),contract_state_service_1=require("./contract-state.service"),operator_state_service_1=require("./operator-state.service"),transaction_service_1=require("./transaction.service"),wallet_state_service_1=require("./wallet-state.service"),wallet_storage_service_1=require("./wallet-storage.service"),inversify_types_1=require("../inversify.types"),util_1=require("../util"),nocust_manager_error_model_1=require("../models/state/nocust-manager-error.model"),DEFAULT_SEED_MESSAGE="I want to use Liquidity Network Swaps",CONFIRMATION_TIMEOUT=1e4,REUSABLE_SUBACCOUNTS=10,TexService=function(){function e(e,t,r,s,a,n,o,i,c){this.contractApiService=e,this.operatorApiService=t,this.operatorStateService=r,this.contractStateService=s,this.walletStateService=a,this.web3Service=n,this.walletStorageService=o,this.transactionService=i,this.storage=c}return e.prototype.registerAddress=function(r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getOrCreateWallet(r.address,r.tokenAddress,r.networkId,r.operatorApiUrl,r.contractAddress)];case 1:return t=e.sent(),[4,this.registerWallet(t,r.operatorApiUrl,r.subAccount)];case 2:return e.sent(),[2]}})})},e.prototype.getOrCreateWallet=function(a,n,o,i,c){return __awaiter(this,void 0,void 0,function(){var t,r,s;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.walletStorageService.loadWallet(a,o,c,n)];case 1:return t=e.sent(),[3,3];case 2:throw r=e.sent(),Error("Retrieving wallet from storage, "+r);case 3:return t?[3,5]:[4,this.contractApiService.getOperatorAccountAddress(c)];case 4:s=e.sent(),t=new wallet_model_1.Wallet(a,o,s,c,n,i),this.walletStorageService.saveWallet(t),e.label=5;case 5:return[2,t]}})})},e.prototype.registerWallet=function(_,p,h){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n,o,i,c,u,l,d;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.operatorApiService.getStatusData(p)];case 1:return t=e.sent().latest.eon_number,[3,3];case 2:throw r=e.sent(),new Error("Could not get current eonNumber, "+r);case 3:s=_.getAdmissionActiveState(t).hash,e.label=4;case 4:return e.trys.push([4,9,,10]),null!=h?[3,6]:[4,this.contractApiService.sign(_.address,s)];case 5:return a=e.sent(),[3,8];case 6:return[4,this.contractApiService.signInternalWithPrivateKey(s,_.address,h.privateKey)];case 7:a=e.sent(),e.label=8;case 8:return[3,10];case 9:throw n=e.sent(),new Error("Could not produce registration signature, "+n);case 10:return[4,this.operatorApiService.registerOperatorRegistrationWebSocketNotificationCallback({webAddress:p,walletAddress:_.address,tokenAddress:_.tokenAddress})];case 11:o=e.sent(),e.label=12;case 12:return e.trys.push([12,14,,15]),i=this.operatorApiService.register(_,a),c=util_1.observableToPromiseWithTimeout(o,CONFIRMATION_TIMEOUT,new nocust_manager_error_model_1.NOCUSTManagerError("Transfer confirmation timeout.",nocust_manager_error_model_1.NOCUSTError.CONFIRMATION_TIMEOUT)),[4,Promise.all([i,c])];case 13:return e.sent(),[3,15];case 14:throw 429===(u=e.sent()).code?(l=p+util_1.addTrailingSlashToUrl(p)+"whitelist/#address="+_.address,new nocust_manager_error_model_1.NOCUSTManagerError("Too many registration request, human verification required. Please whitelist your address at "+l,nocust_manager_error_model_1.NOCUSTError.REGISTRATION_THROTTLING)):u.code===nocust_manager_error_model_1.NOCUSTError.CONFIRMATION_TIMEOUT?u:-1<u.message.search("must make a unique set.")?new nocust_manager_error_model_1.NOCUSTManagerError("Wallet already registered",nocust_manager_error_model_1.NOCUSTError.NON_UNIQUE_TRANSFER):new nocust_manager_error_model_1.NOCUSTManagerError("Could not post registration.",nocust_manager_error_model_1.NOCUSTError.POST_FAILURE,u);case 15:return e.trys.push([15,17,,18]),[4,this.operatorApiService.getWalletData(_.address,_.tokenAddress,p,t)];case 16:return[2,e.sent()];case 17:throw d=e.sent(),new Error("Could not fetch wallet data, "+d);case 18:return[2]}})})},e.prototype.makeTransfer=function(v,A,S,f,w){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n,o,i,c,u,l,d,_,p,h;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.transactionService.prepareOutgoingTransfer(v,A,S,!0)];case 1:return r=e.sent(),[3,3];case 2:throw s=e.sent(),new Error("Could not prepare transfer, "+s);case 3:if(!r)throw new Error("Failed to prepare transfer");e.label=4;case 4:return e.trys.push([4,6,,7]),i=(i=o=null)==w?(o=this.contractApiService.sign(v.address,r.hashes.activeState),this.contractApiService.sign(v.address,r.hashes.marker)):(o=this.contractApiService.signInternalWithPrivateKey(r.hashes.activeState,w.address,w.privateKey),this.contractApiService.signInternalWithPrivateKey(r.hashes.marker,w.address,w.privateKey)),[4,Promise.all([o,i])];case 5:return t=e.sent(),a=t[0],n=t[1],[3,7];case 6:throw c=e.sent(),new Error("Could not sign hashes, "+c);case 7:return[4,this.operatorApiService.registerTransferWebSocketNotificationCallback({webAddress:f,walletAddress:v.address,socketMessageType:operator_api_service_1.TransactionSocketMessageType.INCOMING_CONFIRMATION,tokenAddress:v.tokenAddress,nonce:r.transfer.nonce.toFixed(0)})];case 8:u=e.sent(),e.label=9;case 9:return e.trys.push([9,11,,12]),l=this.transactionService.sendOutgoingTransfer(v,r,a,n),d=util_1.observableToPromiseWithTimeout(u,CONFIRMATION_TIMEOUT,new nocust_manager_error_model_1.NOCUSTManagerError("Transfer confirmation timeout.",nocust_manager_error_model_1.NOCUSTError.CONFIRMATION_TIMEOUT)),[4,Promise.all([l,d])];case 10:return _=e.sent(),p=_[0],_[1],[2,p];case 11:throw h=e.sent(),new Error("Could not post transfer, "+h);case 12:return[2]}})})},e.prototype.finalizeSwap=function(d,_,p,h,v,A){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n,o,i,c,u,l;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getSyncedWallet({address:d.address,tokenAddress:_,networkId:h,operatorApiUrl:v,contractAddress:A,subAccount:d})];case 1:if(t=e.sent(),r=t.latestEon.activeState.transfers.concat([t.latestEon.activeState.pendingTransfer]),!(s=r.find(function(e){return e&&e.txId===p}))||!s.isSwap)throw new Error("Could not find relevant swap data for txId "+p);a=this.transactionService.prepareSwapFinalization(t,s),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.contractApiService.signInternalWithPrivateKey(a.hashes.recipientFinalizationActiveState,d.address,d.privateKey)];case 3:return n=e.sent(),[3,5];case 4:throw o=e.sent(),new Error("Could not sign hashes"+o);case 5:return[4,this.operatorApiService.registerTransferWebSocketNotificationCallback({webAddress:v,walletAddress:t.address,socketMessageType:operator_api_service_1.TransactionSocketMessageType.FINALIZED_SWAP,tokenAddress:t.tokenAddress})];case 6:i=e.sent(),e.label=7;case 7:return e.trys.push([7,9,,10]),c=this.transactionService.sendSwapFinalization(t,s,n),u=util_1.observableToPromiseWithTimeout(i,CONFIRMATION_TIMEOUT,new nocust_manager_error_model_1.NOCUSTManagerError("Transfer confirmation timeout.",nocust_manager_error_model_1.NOCUSTError.CONFIRMATION_TIMEOUT)),[4,Promise.all([c,u])];case 8:return e.sent(),[3,10];case 9:throw l=e.sent(),new Error("Could not post swap finalization, "+l);case 10:return[2]}})})},e.prototype.getOperatorParameters=function(a){return __awaiter(this,void 0,void 0,function(){var t,r,s;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,this.web3Service.networkId()];case 1:return r=e.sent(),[4,this.contractApiService.currentEonNumber(a)];case 2:return t=e.sent(),[3,4];case 3:throw s=e.sent(),new Error("Unable to fetch values, "+s);case 4:return[2,{networkId:r,currentEonNumber:t}]}})})},e.prototype.getSyncedWallet=function(c){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n,o,i;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getOrCreateWallet(c.address,c.tokenAddress,c.networkId,c.operatorApiUrl,c.contractAddress)];case 1:r=e.sent(),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.all([this.contractStateService.fetchContractState(r),this.operatorStateService.fetchOperatorState(r)])];case 3:return t=e.sent(),s=t[0],a=t[1],[3,5];case 4:throw o=e.sent(),new Error("Could not fetch contract state and operator state "+o);case 5:return e.trys.push([5,7,,8]),[4,this.walletStateService.syncWalletState(r,s,a)];case 6:return n=e.sent(),[3,8];case 7:throw i=e.sent(),new Error("Could not sync wallet state"+i);case 8:if(n.updateError)throw new Error("Could not sync wallet... "+n.updateError);return this.walletStorageService.saveWallet(n.wallet),[2,n.wallet]}})})},e.prototype.harvestSwapWallet=function(s,a,n,o,i,c){return __awaiter(this,void 0,void 0,function(){var t,r;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getSyncedWallet({address:a.address,tokenAddress:n,networkId:o,operatorApiUrl:i,contractAddress:c,subAccount:a})];case 1:return t=e.sent(),(r=t.offChainBalance).isZero()?[3,3]:[4,this.makeTransfer(t,s,r,i,a)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.processSwapWallet=function(c,u,l,d,_,p,h){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n,o,i=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.operatorApiService.getWalletData(u.address,l,d,p)];case 1:if(t=e.sent().transfers,r=[],s=[],n=!(a=!0),t.forEach(function(e){e.complete||(n=!0),null!=e.amount_swapped&&e.recipient.token==l?e.complete?null==e.recipient_finalization_active_state&&s.push(e):r.push(e):a=!1}),!(0<s.length))return[3,5];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,Promise.all(s.map(function(e){return i.finalizeSwap(u,e.wallet.token,e.id,h,d,_)}))];case 3:return e.sent(),[3,5];case 4:throw o=e.sent(),new Error("Could not finalize swaps "+o);case 5:return a&&0==r.length?[4,this.harvestSwapWallet(c,u,l,h,d,_)]:[3,7];case 6:e.sent(),e.label=7;case 7:return[2,{isUsed:n,pendingSwaps:r}]}})})},e.prototype.getSubAccountSeed=function(r,s){return void 0===s&&(s=DEFAULT_SEED_MESSAGE),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.contractApiService.sign(r,s)];case 1:return t=e.sent(),[2,ethereumjs_util_1.keccak256(t.rsv).toString("hex")]}})})},e.prototype.getSubAccountAtIndex=function(e,t){if(!/[0-9A-Fa-f]+/g.test(e))throw new Error("Seed is not a string of hexadecimal values");var r=hdkey_1.default.fromMasterSeed(Buffer.from(e,"hex")).derive("m/44'/60'/0'/0/"+t),s=ethereumjs_util_1.bufferToHex(r.privateKey),a=ethereumjs_util_1.privateToPublic(r.privateKey),n=ethereumjs_util_1.publicToAddress(a).toString("hex"),o=ethereumjs_util_1.toChecksumAddress(n);return new tex_sub_account_model_1.TexSubAccount(t,o,s)},e.prototype.swapSyncProcedure=function(f){return __awaiter(this,void 0,void 0,function(){var t,u,l,d,_,p,h,v,r,s,a,n,A,o,S=this;return __generator(this,function(e){switch(e.label){case 0:return[4,this.getOperatorParameters(f.contractAddress)];case 1:return t=e.sent(),u=t.networkId,l=t.currentEonNumber,d=[f.buyTokenAddress,f.sellTokenAddress],_=[],p=[],h=[],v=[],[4,this.getCachedResuableSubAccountIndex(f.address,f.buyTokenAddress,f.sellTokenAddress)];case 2:r=e.sent(),s=r.freeSubAccountIndexes,0==(a=r.blockedSubAccountIndexes).length?p=Array.from({length:REUSABLE_SUBACCOUNTS},function(e,t){return t}):(p.push.apply(p,a),h.push.apply(h,s)),n=function(t){var r,s,a,n,o,i,c;return __generator(this,function(e){switch(e.label){case 0:return r=A.getSubAccountAtIndex(f.seed,p[t]),f.forceAdmission?[4,Promise.all(d.map(function(t){return __awaiter(S,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,4]),[4,this.operatorApiService.whoisWallet(t,r.address,f.operatorApiUrl)];case 1:return e.sent(),[3,4];case 2:return e.sent(),[4,this.registerAddress({address:r.address,tokenAddress:t,networkId:u,operatorApiUrl:f.operatorApiUrl,contractAddress:f.contractAddress,subAccount:r})];case 3:return e.sent(),[3,4];case 4:return[2]}})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:s=!0,a=0,e.label=3;case 3:if(!(a<d.length))return[3,8];e.label=4;case 4:return e.trys.push([4,6,,7]),[4,A.processSwapWallet(f.address,r,d[a],f.operatorApiUrl,f.contractAddress,l,u)];case 5:return n=e.sent(),o=n.isUsed,i=n.pendingSwaps,o&&(s=!1,_.push.apply(_,i)),[3,7];case 6:throw c=e.sent(),new Error("Could not process swap sub accout, "+c);case 7:return a++,[3,3];case 8:return s?h.push(r.index):v.push(r.index),[2]}})},A=this,o=0,e.label=3;case 3:return o<p.length?[5,n(o)]:[3,6];case 4:e.sent(),e.label=5;case 5:return o++,[3,3];case 6:return this.setCachedReusableSubAccountIndex(f.address,f.buyTokenAddress,f.sellTokenAddress,h,v),[2,{freeSubAccountIndexes:h,blockedSubAccountIndexes:v,pendingSwaps:_}]}})})},e.prototype.setCachedReusableSubAccountIndex=function(r,s,a,n,o){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:t=r+"/",t+=s<=a?s+"/"+a:a+"/"+s,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this.storage.set("freeSubAccountIndexes/"+t,n.join(","))];case 2:return e.sent(),[4,this.storage.set("blockedSubAccountIndexes/"+t,o.join(","))];case 3:return e.sent(),[3,5];case 4:throw e.sent(),new Error("Unable to save sub account indexes");case 5:return[2]}})})},e.prototype.getCachedResuableSubAccountIndex=function(o,i,c){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n;return __generator(this,function(e){switch(e.label){case 0:t=o+"/",t+=i<=c?i+"/"+c:c+"/"+i,r=[],s=[],e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this.storage.get("freeSubAccountIndexes/"+t)];case 2:return a=e.sent(),[4,this.storage.get("blockedSubAccountIndexes/"+t)];case 3:return n=e.sent(),a&&a.split(",").forEach(function(e){r.push(parseInt(e))}),n&&n.split(",").forEach(function(e){s.push(parseInt(e))}),[2,{freeSubAccountIndexes:r,blockedSubAccountIndexes:s}];case 4:throw e.sent(),new Error("Unable to get cached sub account index");case 5:return[2]}})})},e.prototype.makeNonBlockingSwap=function(m){return __awaiter(this,void 0,void 0,function(){var t,r,s,a,n,o,i,c,u,l,d,_,p,h,v,A,S,f,w,b,g;return __generator(this,function(e){switch(e.label){case 0:return[4,this.web3Service.networkId()];case 1:return s=e.sent(),null!=m.customSeed?[3,3]:(a=m,[4,this.getSubAccountSeed(m.address)]);case 2:a.customSeed=e.sent(),e.label=3;case 3:return null!=m.subAccount?[3,7]:[4,this.getCachedResuableSubAccountIndex(m.address,m.buyTokenAddress,m.sellTokenAddress)];case 4:return n=e.sent(),o=n.freeSubAccountIndexes,i=n.blockedSubAccountIndexes,0!=o.length?[3,6]:[4,this.swapSyncProcedure({address:m.address,buyTokenAddress:m.buyTokenAddress,sellTokenAddress:m.sellTokenAddress,seed:m.customSeed,operatorApiUrl:m.operatorApiUrl,contractAddress:m.contractAddress,forceAdmission:!0})];case 5:c=e.sent(),o=c.freeSubAccountIndexes,i=c.blockedSubAccountIndexes,e.label=6;case 6:if(0==o.length)throw new nocust_manager_error_model_1.NOCUSTManagerError("Cannot make more swaps, "+REUSABLE_SUBACCOUNTS+" swap limit reached.",nocust_manager_error_model_1.NOCUSTError.SWAP_LIMIT_REACHED_ERROR);u=o.shift(),i.push(u),m.subAccount=this.getSubAccountAtIndex(m.customSeed,u),this.setCachedReusableSubAccountIndex(m.address,m.buyTokenAddress,m.sellTokenAddress,o,i),e.label=7;case 7:return[4,this.getSyncedWallet({address:m.address,tokenAddress:m.sellTokenAddress,networkId:s,operatorApiUrl:m.operatorApiUrl,contractAddress:m.contractAddress})];case 8:return l=e.sent(),[4,this.makeTransfer(l,m.subAccount.address,m.sellAmount,m.operatorApiUrl)];case 9:return e.sent(),[4,Promise.all([this.getSyncedWallet({address:m.subAccount.address,tokenAddress:m.sellTokenAddress,networkId:s,operatorApiUrl:m.operatorApiUrl,contractAddress:m.contractAddress,subAccount:m.subAccount}),this.getSyncedWallet({address:m.subAccount.address,tokenAddress:m.buyTokenAddress,networkId:s,operatorApiUrl:m.operatorApiUrl,contractAddress:m.contractAddress,subAccount:m.subAccount})])];case 10:t=e.sent(),d=t[0],_=t[1],e.label=11;case 11:return e.trys.push([11,13,,14]),[4,this.transactionService.prepareSwap(d,_,m.sellAmount,m.buyAmount)];case 12:return p=e.sent(),[3,14];case 13:throw h=e.sent(),new Error("Could not prepare swap "+h);case 14:return e.trys.push([14,16,,17]),[4,Promise.all([this.contractApiService.signInternalWithPrivateKey(p.hashes.recipientActiveState,m.subAccount.address,m.subAccount.privateKey),this.contractApiService.signInternalWithPrivateKey(p.hashes.recipientFulfillmentActiveState,m.subAccount.address,m.subAccount.privateKey),this.contractApiService.signInternalWithPrivateKey(p.hashes.senderActiveState,m.subAccount.address,m.subAccount.privateKey),this.contractApiService.signInternalWithPrivateKey(p.hashes.marker,m.subAccount.address,m.subAccount.privateKey)])];case 15:return r=e.sent(),v=r[0],A=r[1],S=r[2],f=r[3],[3,17];case 16:throw w=e.sent(),new Error("Could not sign hashes"+w);case 17:return e.trys.push([17,19,,20]),[4,this.transactionService.sendSwap(d,_,p,S,v,A,f)];case 18:return b=e.sent(),[3,20];case 19:throw g=e.sent(),new Error("Could not post swap, "+g);case 20:return[2,b]}})})},e=__decorate([inversify_1.injectable(),__param(0,inversify_1.inject(contract_api_service_1.ContractApiService)),__param(1,inversify_1.inject(operator_api_service_1.OperatorApiService)),__param(2,inversify_1.inject(operator_state_service_1.OperatorStateService)),__param(3,inversify_1.inject(contract_state_service_1.ContractStateService)),__param(4,inversify_1.inject(wallet_state_service_1.WalletStateService)),__param(5,inversify_1.inject(inversify_types_1.TYPES.EXTERNAL.WEB3_SERVICE_INTERFACE)),__param(6,inversify_1.inject(wallet_storage_service_1.WalletStorageService)),__param(7,inversify_1.inject(transaction_service_1.TransactionService)),__param(8,inversify_1.inject(inversify_types_1.TYPES.EXTERNAL.STORAGE_MANAGER_INTERFACE)),__metadata("design:paramtypes",[contract_api_service_1.ContractApiService,operator_api_service_1.OperatorApiService,operator_state_service_1.OperatorStateService,contract_state_service_1.ContractStateService,wallet_state_service_1.WalletStateService,Object,wallet_storage_service_1.WalletStorageService,transaction_service_1.TransactionService,Object])],e)}();exports.TexService=TexService;