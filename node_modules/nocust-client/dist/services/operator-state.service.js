"use strict";var __decorate=this&&this.__decorate||function(e,t,r,a){var i,o=arguments.length,s=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,a);else for(var n=e.length-1;0<=n;n--)(i=e[n])&&(s=(o<3?i(s):3<o?i(t,r,s):i(t,r))||s);return 3<o&&s&&Object.defineProperty(t,r,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(r,a){return function(e,t){a(e,t,r)}};Object.defineProperty(exports,"__esModule",{value:!0});var rxjs_1=require("rxjs"),operator_api_service_1=require("./operator-api.service"),operator_state_model_1=require("../models/state/operator-state.model"),inversify_1=require("inversify"),inversify_types_1=require("../inversify.types"),OperatorStateService=function(){function e(e,t,r){var a=this;this.walletStatePollObservable=e,this.operatorStateFetchObserver=t,this.operatorApi=r,e.subscribe(function(e){a.fetchOperatorState(e.wallet).then(function(e){a.operatorStateFetchObserver.next(e)})})}return e.prototype.fetchOperatorState=function(e){var t=new operator_state_model_1.OperatorState;return t.timestamp=(new Date).getTime(),Promise.all([this.operatorApi.getStatusData(e.webAddress),this.operatorApi.getWalletData(e.address,e.tokenAddress,e.webAddress,e.latestEon.eonNumber-1).catch(function(){})]).then(function(e){return t.statusData=e[0],t.walletData=e[1],t}).catch(function(){return t})},e=__decorate([inversify_1.injectable(),__param(0,inversify_1.inject(inversify_types_1.TYPES.SUBJECT.WALLET_STATE_POLL)),__param(1,inversify_1.inject(inversify_types_1.TYPES.SUBJECT.HUB_STATE_FETCH)),__param(2,inversify_1.inject(operator_api_service_1.OperatorApiService)),__metadata("design:paramtypes",[rxjs_1.Observable,Object,operator_api_service_1.OperatorApiService])],e)}();exports.OperatorStateService=OperatorStateService;