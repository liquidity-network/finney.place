"use strict";var __decorate=this&&this.__decorate||function(e,t,r,i){var o,s=arguments.length,n=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var l=e.length-1;0<=l;l--)(o=e[l])&&(n=(s<3?o(n):3<s?o(t,r,n):o(t,r))||n);return 3<s&&n&&Object.defineProperty(t,r,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(r,i){return function(e,t){i(e,t,r)}};Object.defineProperty(exports,"__esModule",{value:!0});var inversify_1=require("inversify"),rxjs_1=require("rxjs"),state_poll_model_1=require("../models/state/state-poll.model"),inversify_types_1=require("../inversify.types"),operators_1=require("rxjs/internal/operators"),PollService=function(){function e(e){this.walletStatePollObserver=e,this.pollTimer=new rxjs_1.Subject;var t=rxjs_1.from(this.pollTimer);this.pollTrigger=t.pipe(operators_1.switchAll())}return e.prototype.startSynchronization=function(e,t,r){this.subscribeToPollTrigger(e),this.pollTimer.next(rxjs_1.timer(t,r))},e.prototype.stopSynchronization=function(){this.pollSubscription&&this.pollSubscription.unsubscribe()},e.prototype.triggerSynchronization=function(e){this.walletStatePollObserver.next(new state_poll_model_1.StateUpdatePoll(e))},e.prototype.subscribeToPollTrigger=function(e){var t=this;this.pollSubscription&&!this.pollSubscription.closed||(this.pollSubscription=this.pollTrigger.subscribe(function(){t.triggerSynchronization(e)}))},e=__decorate([inversify_1.injectable(),__param(0,inversify_1.inject(inversify_types_1.TYPES.SUBJECT.WALLET_STATE_POLL)),__metadata("design:paramtypes",[Object])],e)}();exports.PollService=PollService;